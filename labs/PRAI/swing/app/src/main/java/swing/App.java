/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package swing;

import javax.swing.*;
import javax.swing.event.TreeSelectionEvent;
import javax.swing.event.TreeSelectionListener;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.TreeSelectionModel;

import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.Hashtable;

public class App {

    UIManager.LookAndFeelInfo[] looks = UIManager.getInstalledLookAndFeels();

    JFrame frame = new JFrame("Програмування систем штучного інтелекту");

    JMenuBar mb = new JMenuBar();

    JMenu m1 = new JMenu("File");
    JMenuItem m1_1 = new JMenuItem("Open");
    JMenuItem m1_2 = new JMenuItem("Save as");

    JMenu m2 = new JMenu("View");
    JMenuItem m2_1 = new JMenu("LookAndFeel");

    JMenu m3 = new JMenu("Help");

    Font treeFont = new Font("Serif", Font.PLAIN, 16);

    DefaultMutableTreeNode rootNode =
            new DefaultMutableTreeNode("Programming of artificial intelligence systems");
    DefaultMutableTreeNode w01Node =
            new DefaultMutableTreeNode("Work01 - BreadFirstSearch");
    DefaultMutableTreeNode w02_1_1Node =
            new DefaultMutableTreeNode("Work02_1 - DepthFirstSearchIter-1");
    DefaultMutableTreeNode w02_1_2Node =
            new DefaultMutableTreeNode("Work02_1 - DepthFirstSearchIter-2");
    DefaultMutableTreeNode w02_2_1Node =
            new DefaultMutableTreeNode("Work02-2 - DepthFirstSearchRec-1");
    DefaultMutableTreeNode w02_2_2Node =
            new DefaultMutableTreeNode("Work02-2 - DepthFirstSearchRec-2");
    DefaultMutableTreeNode w03Node =
            new DefaultMutableTreeNode("Work03 - MazeSolver");
    DefaultMutableTreeNode w04Node =
            new DefaultMutableTreeNode("Work04 - IDDFS");
    DefaultMutableTreeNode w05Node =
            new DefaultMutableTreeNode("Work05 - AStarSearch");
    DefaultMutableTreeNode w06_1Node =
            new DefaultMutableTreeNode("Work06-1 - BruteForce");
    DefaultMutableTreeNode w06_2Node =
            new DefaultMutableTreeNode("Work06-2 - HillClimbing");
    DefaultMutableTreeNode w07Node =
            new DefaultMutableTreeNode("Work07 - TabuSearch");
    DefaultMutableTreeNode w08Node =
            new DefaultMutableTreeNode("Work08 - SimulatedAnnealingSearch");

    JTree tree = new JTree(rootNode);
    JScrollPane treeScrollPane = new JScrollPane(tree);

    JTabbedPane tabs = new JTabbedPane();
    JScrollPane tabsScrollPane = new JScrollPane(tabs);

    JSplitPane cenPane = new JSplitPane(JSplitPane.HORIZONTAL_SPLIT,treeScrollPane, tabsScrollPane);

    JPanel statPanel = new JPanel(); 

    //JLabel label = new JLabel("Enter Text");
    //JTextField tf = new JTextField(10); 

    //JButton send = new JButton("Send");
    //JButton reset = new JButton("Reset");



    //JTextArea ta = new JTextArea();

    //Font logFont = new Font("Serif", Font.PLAIN, 14);

    Hashtable<String, Work> works = new Hashtable<String, Work>();


    void setupMenu() {
        mb.add(m1);
        mb.add(m2);
        mb.add(m3);

        m1.add(m1_1);
        m1.add(m1_2);
        
        m2.add(m2_1);

        for (UIManager.LookAndFeelInfo look : looks) {
            String name = look.getClassName();

            JMenuItem item = new JMenuItem(name);
            item.addActionListener(new LookListener());
            m2_1.add(item);
        }
    }

    void setupTreeNodes() {
        rootNode.add(w01Node);
        rootNode.add(w02_1_1Node);
        rootNode.add(w02_1_2Node);
        rootNode.add(w02_2_1Node);
        rootNode.add(w02_2_2Node);
        rootNode.add(w03Node);
        rootNode.add(w04Node);
        rootNode.add(w05Node);
        rootNode.add(w06_1Node);
        rootNode.add(w06_2Node);
        rootNode.add(w07Node);
        rootNode.add(w08Node);
    }

    void setupContent() {

        tree.setFont(treeFont);
        tree.getSelectionModel().setSelectionMode
                (TreeSelectionModel.SINGLE_TREE_SELECTION);
        tree.addTreeSelectionListener(new TreeListener());

        treeScrollPane.setMinimumSize(new Dimension(100, 200));
        tabsScrollPane.setMinimumSize(new Dimension(200, 200));
        
        cenPane.setOneTouchExpandable(true);
        cenPane.setDividerLocation(frame.getWidth()/3);




        //statPanel.add(label); // Components Added using Flow Layout
        //statPanel.add(tf);
        //statPanel.add(send);
        //statPanel.add(reset);
    }
    
    void setupWorks() {
        works.put((String)w01Node.getUserObject(), new Work01());
        works.put((String)w02_1_1Node.getUserObject(), new Work02_1_1());
        works.put((String)w02_1_2Node.getUserObject(), new Work02_1_2());
        works.put((String)w02_2_1Node.getUserObject(), new Work02_2_1());
        works.put((String)w02_2_2Node.getUserObject(), new Work02_2_2());
        works.put((String)w03Node.getUserObject(), new Work03());
        works.put((String)w04Node.getUserObject(), new Work04());
        works.put((String)w05Node.getUserObject(), new Work05());
        works.put((String)w06_1Node.getUserObject(), new Work06_1());
        works.put((String)w06_2Node.getUserObject(), new Work06_2());
        works.put((String)w07Node.getUserObject(), new Work07());
        works.put((String)w08Node.getUserObject(), new Work08());
    }

    void run() throws ClassNotFoundException, InstantiationException, IllegalAccessException, UnsupportedLookAndFeelException {
            
           
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setSize(1024, 720);

        setupWorks();
        setupMenu();
        setupTreeNodes();
        setupContent();

                
        frame.getContentPane().add(BorderLayout.SOUTH, statPanel);
        frame.getContentPane().add(BorderLayout.NORTH, mb);
        frame.getContentPane().add(BorderLayout.CENTER, cenPane);
        
        UIManager.setLookAndFeel(looks[looks.length-1].getClassName());
        SwingUtilities.updateComponentTreeUI(frame);
        
        frame.setVisible(true);
    } 
   
    
    public static void main(String[] args) throws ClassNotFoundException, InstantiationException, IllegalAccessException, UnsupportedLookAndFeelException {
        App app = new App();
        app.run();
    }

    class TreeListener implements TreeSelectionListener {

        public void valueChanged(TreeSelectionEvent e) {
            DefaultMutableTreeNode node = (DefaultMutableTreeNode)
                           tree.getLastSelectedPathComponent();
            if (node == null) return;

            String nodeInfo = (String)(node.getUserObject());

            System.out.println(String.format("%d %s", node.getLevel(), nodeInfo));

            if (node.isLeaf()) {
                //TextArea log;
                int ind = tabs.indexOfTab(nodeInfo);

                Work work = works.get(nodeInfo);
                
                if (ind == -1) {
                    //log = new TextArea("");
                    //log.setEditable(false);
                    //log.setFont(logFont);

                    Component comp = work.getComponent();

                    String msg = String.format("Open tab <%s> index %d", nodeInfo, ind);
                    System.out.println(msg);
                    //log.setText(log.getText() + String.format("Open tab <%s>\n", nodeInfo));
                    work.writeLog(msg);

                    tabs.setSelectedComponent(tabs.add(nodeInfo, comp));

                    //ind = tabs.indexOfTab(nodeInfo);
                } else {
                    String msg = String.format("\nFocus tab <%s> index %d", nodeInfo, ind);
                    System.out.println(msg);
                    work.writeLog(msg);
                    tabs.setSelectedIndex(ind);

                    //Component comp = (TextArea)tabs.getSelectedComponent();
                    //log.setText(log.getText() + String.format("Focus tab <%s>\n", nodeInfo));
                }

                //Work work = works.get(nodeInfo);
                work.run();

            }
        }
    }

    class LookListener implements ActionListener {

        public void actionPerformed(ActionEvent e) {
            System.out.println(e.getActionCommand());
            try {
                UIManager.setLookAndFeel(e.getActionCommand());
                SwingUtilities.updateComponentTreeUI(frame);
            } catch (ClassNotFoundException e1) {
                // TODO Auto-generated catch block
                e1.printStackTrace();
            } catch (InstantiationException e1) {
                // TODO Auto-generated catch block
                e1.printStackTrace();
            } catch (IllegalAccessException e1) {
                // TODO Auto-generated catch block
                e1.printStackTrace();
            } catch (UnsupportedLookAndFeelException e1) {
                // TODO Auto-generated catch block
                e1.printStackTrace();
            }
        }
    }
}
